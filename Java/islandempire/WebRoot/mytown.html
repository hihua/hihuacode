<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>MyTown</title>
		<link rel="stylesheet" type="text/css" href="css.css" />
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/ajax.js"></script>
		<script type="text/javascript" src="js/mytowns.js"></script>
	</head>
	<body>
		<table width="100%" align="center" cellpadding="0" cellspacing="0" border="0">
			<tr>
				<td width="50%" valign="top">
					<table width="100%" align="center" cellpadding="0" cellspacing="0" border="0">
						<tr>
							<td id="config"></td>							
						</tr>
						<tr>
							<td id="towns"></td>
						</tr>
					</table>
				</td>
				<td width="50%" valign="top">
					<table width="100%" align="center" cellpadding="0" cellspacing="0" border="0">
						<tr>
							<td id="messages"></td>							
						</tr>
						<tr>
							<td align="center" height="35">
								X&nbsp;<input type="text" id="x" size="7" />
								Y&nbsp;<input type="text" id="y" size="7" />							
								<input type="button" id="query" value=" 查询 " onclick="" />
							</td>
						</tr>
						<tr>
							<td id="island" align="center"></td>							
						</tr>
					</table>
				</td>
			</tr>	
		</table>	
		<script type="text/javascript">
			var MyTowns = [57971, 68274, 71071, 71989, 108094];
			//57971		hihua
			//68274 	hhh
			//71071		hhihua
			//71989		haha
			//108094	hhhhhh
			
			function getMyTowns() {
				for (var i = 0;i < MyTowns.length;i++)
					requestMyTowns(MyTowns[i], setMyTown);
					
				setTimeout("getMyTowns()", 30000);			
			}
			
			function getFinishTime(buildingQueues, buildingId, lines) {
				if (buildingQueues == null)
					return "";
				
				var finishTime = "";
				$.each(buildingQueues, function(idx, buildingQueue) {
					if (lines) {
						var linesEvents = buildingQueue.lines_events;
						if (linesEvents != null) {
							$.each(linesEvents, function(idx, linesEvent) {
								if (linesEvent.building_id == buildingId) {
									var date = new Date(buildingQueue.finish_time * 1000);
									finishTime = date.pattern("yyyy-MM-dd HH:mm:ss");
								}
							});						
						}					
					} else {
						if (buildingQueue.building_id == buildingId) {
							var date = new Date(buildingQueue.finish_time * 1000);
							finishTime = date.pattern("yyyy-MM-dd HH:mm:ss");
						}
					}					
				});
				
				return finishTime;
			}
						
			function setMyTown(json, id) {
				var town = json.town;
				if (town == null)
					return;				
				
				var div = "towns";
				var buildings = town.buildings;
				var alliance = town.alliance;
				var resources = town.resources;
				var soldiers = town.soldiers;
				var heroInfo = town.hero_info;
				var buildingQueues = town.building_queue;
				var transportQueues = town.transport_queue;
								
				html = "";
				html += "<table width=\"640\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"1\" class=\"Table1\">";
				html += "<tr>";
				html += "<td width=\"10%\" align=\"center\" valign=\"middle\">基本信息</td>";
				html += "<td width=\"40%\">";				
				html += "<table width=\"94%\" border=\"0\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-left:5px\">";
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">用户名: </td>";
				html += "<td>" + town.owner + "</td>";        
				html += "</tr>";
				html += "<tr>";								
				html += "<td align=\"left\" width=\"34%\" height=\"25\">城市名称: </td>";
				if (town.is_capital == true)			        
					html += "<td style=\"color:#FF0000\">" + town.name + "</td>";
				else
					html += "<td>" + town.name + "</td>";
				 				        
				html += "</tr>";        
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">城市ID: </td>";
				html += "<td>" + town.id + "</td>";        
				html += "</tr>";
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">状态: </td>";				
				if (town.city_status == "normal")
					html += "<td>" + town.city_status + "</td>";
				else
					html += "<td style=\"color:#FF0000\">" + town.city_status + "</td>";
					        
				html += "</tr>";
				html += "<tr>";
				
				var resource_type = "";
				if (town.resource_type == 1)
					resource_type = "黄金";
					
				if (town.resource_type == 2)
					resource_type = "大理石";
					
				if (town.resource_type == 3)
					resource_type = "黑铁石";
				
				html += "<td align=\"left\" width=\"34%\" height=\"25\">资源类别: </td>";
				html += "<td>" + resource_type + "</td>";        
				html += "</tr>";
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">等级: </td>";
				html += "<td>" + town.level + "</td>";        
				html += "</tr>";
				html += "<tr>";
				
				var alliance_name = "";
				if (alliance != null)
					alliance_name = alliance.alliance_name;
				
				html += "<td align=\"left\" width=\"34%\" height=\"25\">联盟: </td>";
				html += "<td>" + alliance_name + "</td>";        
				html += "</tr>";
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">坐标: </td>";
				html += "<td>" + town.island_x + "," + town.island_y + "</td>";        
				html += "</tr>";												
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">维护量: </td>";
				html += "<td>" + town.presence_defenders + "</td>";        
				html += "</tr>";
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">侦察量: </td>";
				html += "<td>" + town.presence_scout + "</td>";        
				html += "</tr>";				
				html += "<tr>";
				html += "<td align=\"left\" width=\"34%\" height=\"25\">宝石: </td>";
				html += "<td>" + town.gems + "</td>";        
				html += "</tr>";											    			    
				html += "</table>";				
				html += "</td>";
				
				html += "<td width=\"10%\" align=\"center\" valign=\"middle\">资源</td>";
				html += "<td width=\"40%\" align=\"left\">";
								
				$.each(resources, function(idx, resource) {
					if (resource.resource_name == "wood") {							
						html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td valign=\"top\" align=\"center\">";							
						html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">木头</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
						html += "</tr>";
						html += "<tr>";
												
						var tmp = "";							
						$.each(buildings, function(idx, building) {
							if (building.building_type == 2) {
								var lines = building.lines;
								$.each(lines, function(idx, line) {
									if (line.status == "upgrading")											
										tmp += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, line.id, true) + "\">" + line.level + "</span>&nbsp;&nbsp;";											
									else
										tmp += "<a href=\"#\" onclick=\"upgradeBuilding(" + line.id + ");return false;\" class=\"AdminToolsLink1\">" + line.level + "</a>&nbsp;&nbsp;";
								});						
							}								
						});
						
						html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">&nbsp;</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + tmp + "</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"30%\">&nbsp;</td>";							
						html += "</tr>";							
						html += "</table>";
						html += "</td>";
						html += "</tr>";
						html += "</table><br/>";
						return;						
					}
					
					if (resource.resource_name == "food") {							
						html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td valign=\"top\" align=\"center\">";							
						html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">食物</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
						html += "</tr>";
						html += "<tr>";
												
						var tmp = "";							
						$.each(buildings, function(idx, building) {
							if (building.building_type == 5) {
								var lines = building.lines;
								$.each(lines, function(idx, line) {
									if (line.status == "upgrading")											
										tmp += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, line.id, true) + "\">" + line.level + "</span>&nbsp;&nbsp;";											
									else
										tmp += "<a href=\"#\" onclick=\"upgradeBuilding(" + line.id + ");return false;\" class=\"AdminToolsLink1\">" + line.level + "</a>&nbsp;&nbsp;";
								});						
							}								
						});
						
						html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">&nbsp;</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + tmp + "</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"30%\">&nbsp;</td>";							
						html += "</tr>";							
						html += "</table>";
						html += "</td>";
						html += "</tr>";
						html += "</table><br/>";
						return;					
					}													
							
					if (town.resource_type == 1) {
						if (resource.resource_name == "gold") {
							html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
							html += "<tr>";
							html += "<td valign=\"top\" align=\"center\">";							
							html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
							html += "<tr>";
							html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">黄金</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
							html += "</tr>";
							
							var tmp = "";							
							$.each(buildings, function(idx, building) {
								if (building.building_type == 8) {
									var lines = building.lines;
									$.each(lines, function(idx, line) {
										if (line.status == "upgrading")											
											tmp += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, line.id, true) + "\">" + line.level + "</span>&nbsp;&nbsp;";											
										else
											tmp += "<a href=\"#\" onclick=\"upgradeBuilding(" + line.id + ");return false;\" class=\"AdminToolsLink1\">" + line.level + "</a>&nbsp;&nbsp;";
									});						
								}								
							});
																				
							html += "<tr>";
							html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">&nbsp;</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + tmp + "</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"30%\">&nbsp;</td>";							
							html += "</tr>";													
							html += "</table>";
							html += "</td>";
							html += "</tr>";
							html += "</table><br/>";							
							return;
						}							
					}
					
					if (town.resource_type == 2) {
						if (resource.resource_name == "marble") {
							html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
							html += "<tr>";
							html += "<td valign=\"top\" align=\"center\">";							
							html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
							html += "<tr>";
							html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">大理石</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
							html += "</tr>";	
							
							var tmp = "";							
							$.each(buildings, function(idx, building) {
								if (building.building_type == 6) {
									var lines = building.lines;
									$.each(lines, function(idx, line) {
										if (line.status == "upgrading")											
											tmp += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, line.id, true) + "\">" + line.level + "</span>&nbsp;&nbsp;";											
										else
											tmp += "<a href=\"#\" onclick=\"upgradeBuilding(" + line.id + ");return false;\" class=\"AdminToolsLink1\">" + line.level + "</a>&nbsp;&nbsp;";
									});						
								}								
							});
									
							html += "<tr>";	
							html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">&nbsp;</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + tmp + "</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"30%\">&nbsp;</td>";							
							html += "</tr>";			
							html += "</table>";
							html += "</td>";
							html += "</tr>";
							html += "</table><br/>";
							return;
						}						
					}
					
					if (town.resource_type == 3) {
						if (resource.resource_name == "iron") {
							html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
							html += "<tr>";
							html += "<td valign=\"top\" align=\"center\">";							
							html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
							html += "<tr>";
							html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">黑铁石</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
							html += "</tr>";
							
							var tmp = "";							
							$.each(buildings, function(idx, building) {
								if (building.building_type == 7) {
									var lines = building.lines;
									$.each(lines, function(idx, line) {
										if (line.status == "upgrading")											
											tmp += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, line.id, true) + "\">" + line.level + "</span>&nbsp;&nbsp;";											
										else
											tmp += "<a href=\"#\" onclick=\"upgradeBuilding(" + line.id + ");return false;\" class=\"AdminToolsLink1\">" + line.level + "</a>&nbsp;&nbsp;";
									});						
								}								
							});
																			
							html += "<tr>";	
							html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">&nbsp;</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + tmp + "</td>";
							html += "<td align=\"left\" valign=\"top\" width=\"30%\">&nbsp;</td>";							
							html += "</tr>";														
							html += "</table>";
							html += "</td>";
							html += "</tr>";
							html += "</table><br/>";
							return;							
						}							
					}
				});					
			
				
				
				$.each(resources, function(idx, resource) {
					if (town.resource_type != 1 && resource.resource_name == "gold") {			
						html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td valign=\"top\" align=\"center\">";							
						html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">黄金</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
						html += "</tr>";																			
						html += "</table>";
						html += "</td>";
						html += "</tr>";
						html += "</table><br/>";							
						return;
					}
				
					if (town.resource_type != 2 && resource.resource_name == "marble") {
						html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td valign=\"top\" align=\"center\">";							
						html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">大理石</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
						html += "</tr>";											
						html += "</table>";
						html += "</td>";
						html += "</tr>";
						html += "</table><br/>";
						return;
					}
					
					if (town.resource_type != 3 && resource.resource_name == "iron") {
						html += "<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td valign=\"top\" align=\"center\">";							
						html += "<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td align=\"left\" valign=\"top\" width=\"25%\" height=\"20\">黑铁石</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"45%\">" + resource.resource_count + "/" + resource.max_volume + "</td>";
						html += "<td align=\"left\" valign=\"top\" width=\"30%\">" + resource.increase_per_hour + "/h</td>";
						html += "</tr>";																					
						html += "</table>";
						html += "</td>";
						html += "</tr>";
						html += "</table><br/>";
						return;							
					}				
				});			
								
				html += "</td>";
				html += "</tr>";
								
				var tr = true;				
				$.each(buildings, function(idx, building) {
					if (building.building_type == 10) {
						if (tr)
							html += "<tr>";
						
						html += "<td width=\"10%\">";
						html += "<table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td height=\"20\">";				
			    					    		
			    		if (building.status == "upgrading")
			    			html += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, building.id, false) + "\">市政厅</span>";											
						else
							html += "<a href=\"#\" onclick=\"upgradeBuilding(" + building.id + ");return false;\" class=\"AdminToolsLink1\">市政厅</a>";
			    		 					    		
			    		html += "</td>";
			    		html += "</tr>";
			    		html += "<tr><td height=\"20\" align=\"center\">" + building.building_type + "</td></tr>";
			    		html += "</table>";
			    		html += "</td>";	    		
			    		html += "<td width=\"40%\">";
			    		html += "<table width=\"92%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">等级: </td><td>" + building.level + "/40" + "</td></tr>";			    					    			    			    			
			    		html += "</table>";
			    		html += "</td>";
			    		
			    		if (!tr) {
							html += "</tr>";
							tr = true;
						} else
							tr = false;
							
						return;						
			    	}					
				});
					
				$.each(buildings, function(idx, building) {
					if (building.building_type == 9) {
						if (tr)
							html += "<tr>";
						
						html += "<td width=\"10%\" align=\"center\">";
						html += "<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td height=\"20\" align=\"center\">";				
			    					    		
			    		if (building.status == "upgrading")
			    			html += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, building.id, false) + "\">市场</span>";											
						else
							html += "<a href=\"#\" onclick=\"upgradeBuilding(" + building.id + ");return false;\" class=\"AdminToolsLink1\">市场</a>";
			    		 					    		
			    		html += "</td>";
			    		html += "</tr>";
			    		html += "<tr><td height=\"20\">" + building.building_type + "</td></tr>";
			    		html += "</table>";
			    		html += "</td>";	    		
			    		html += "<td width=\"40%\">";
			    		html += "<table width=\"94%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"25%\">等级: </td><td>" + building.level + "/40" + "</td></tr>";
			    		
			    		var property = building.property;			    					    		
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"25%\">售量: </td><td>" + property.left_capacity + "/" + property.capacity + "</td></tr>";			    					    			    			    			
			    		html += "</table>";
			    		html += "</td>";
			    		
			    		if (!tr) {
							html += "</tr>";
							tr = true;
						} else
							tr = false;
							
						return;						
			    	}					
				});
				
				$.each(buildings, function(idx, building) {
					if (building.building_type == 3) {
						if (tr)
							html += "<tr>";
						
						html += "<td width=\"10%\" align=\"center\">";
						html += "<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td height=\"20\" align=\"center\">";				
			    					    		
			    		if (building.status == "upgrading")
			    			html += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, building.id, false) + "\">仓库</span>";											
						else
							html += "<a href=\"#\" onclick=\"upgradeBuilding(" + building.id + ");return false;\" class=\"AdminToolsLink1\">仓库</a>";
			    		 					    		
			    		html += "</td>";
			    		html += "</tr>";
			    		html += "<tr><td height=\"20\">" + building.building_type + "</td></tr>";
			    		html += "</table>";
			    		html += "</td>";	    		
			    		html += "<td width=\"40%\">";
			    		html += "<table width=\"94%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">等级: </td><td>" + building.level + "/40" + "</td></tr>";
			    		
			    		var property = building.property;			    					    		
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">存量: </td><td>" + property.capacity + "</td></tr>";			    					    			    			    			
			    		html += "</table>";
			    		html += "</td>";
			    		
			    		if (!tr) {
							html += "</tr>";
							tr = true;
						} else
							tr = false;
							
						return;					
			    	}					
				});
				
				$.each(buildings, function(idx, building) {
					if (building.building_type == 4) {
						if (tr)
							html += "<tr>";
						
						html += "<td width=\"10%\" align=\"center\">";
						html += "<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td height=\"20\" align=\"center\">";				
			    					    		
			    		if (building.status == "upgrading")
			    			html += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, building.id, false) + "\">港口</span>";											
						else
							html += "<a href=\"#\" onclick=\"upgradeBuilding(" + building.id + ");return false;\" class=\"AdminToolsLink1\">港口</a>";
			    		 					    		
			    		html += "</td>";
			    		html += "</tr>";
			    		html += "<tr><td height=\"20\">" + building.building_type + "</td></tr>";
			    		html += "</table>";
			    		html += "</td>";	    		
			    		html += "<td width=\"40%\">";
			    		html += "<table width=\"94%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"25%\">等级: </td><td>" + building.level + "/40" + "</td></tr>";
			    		
			    		var property = building.property;			    					    		
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"25%\">运量: </td><td>" + property.fleet_quota + "/次</td></tr>";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"25%\">有效: </td><td>" + property.available_fleet + "次</td></tr>";			    					    			    			    			
			    		html += "</table>";
			    		html += "</td>";
			    		
			    		if (!tr) {
							html += "</tr>";
							tr = true;
						} else
							tr = false;
							
						return;					
			    	}					
				});
				
				$.each(buildings, function(idx, building) {
					if (building.building_type == 1) {
						if (tr)
							html += "<tr>";
						
						html += "<td width=\"10%\" align=\"center\">";
						html += "<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td height=\"20\" align=\"center\">";				
			    					    		
			    		if (building.status == "upgrading")
			    			html += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, building.id, false) + "\">兵营</span>";											
						else
							html += "<a href=\"#\" onclick=\"upgradeBuilding(" + building.id + ");return false;\" class=\"AdminToolsLink1\">兵营</a>";
			    		 					    		
			    		html += "</td>";
			    		html += "</tr>";
			    		html += "<tr><td height=\"20\">" + building.building_type + "</td></tr>";
			    		html += "</table>";
			    		html += "</td>";	    		
			    		html += "<td width=\"40%\">";
			    		html += "<table width=\"94%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">等级: </td><td>" + building.level + "/40" + "</td></tr>";
			    		
			    		var property = building.property;			    					    		
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">提速: </td><td>" + property.reduce_time_rate + "%</td></tr>";
			    		
			    		$.each(soldiers, function(idx, soldier) {
			    			var name = soldier.name;
			    			var count = soldier.count;
			    			
			    			if (name == "infantry") {
			    				html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">铁剑士: </td><td>" + count + "</td></tr>";
			    				return;			    			
			    			}
			    			
			    			if (name == "scout") {
			    				html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">侦察兵: </td><td>" + count + "</td></tr>";
			    				return;			    			
			    			}
			    			
			    			if (name == "musketman") {
			    				html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">火枪手: </td><td>" + count + "</td></tr>";
			    				return;
			    			}
			    			
			    			if (name == "catapult") {
			    				html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">投石车: </td><td>" + count + "</td></tr>";
			    				return;
			    			}
			    		});
			    					    					    					    			    			    			
			    		html += "</table>";
			    		html += "</td>";
			    		
			    		if (!tr) {
							html += "</tr>";
							tr = true;
						} else
							tr = false;
							
						return;					
			    	}					
				});
				
				$.each(buildings, function(idx, building) {
					if (building.building_type == 13) {
						if (tr)
							html += "<tr>";
						
						html += "<td width=\"10%\" align=\"center\">";
						html += "<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td height=\"20\" align=\"center\">";				
			    					    		
			    		if (building.status == "upgrading")
			    			html += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, building.id, false) + "\">造船厂</span>";											
						else
							html += "<a href=\"#\" onclick=\"upgradeBuilding(" + building.id + ");return false;\" class=\"AdminToolsLink1\">造船厂</a>";
			    		 					    		
			    		html += "</td>";
			    		html += "</tr>";
			    		html += "<tr><td height=\"20\">" + building.building_type + "</td></tr>";
			    		html += "</table>";
			    		html += "</td>";	    		
			    		html += "<td width=\"40%\">";
			    		html += "<table width=\"94%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">等级: </td><td>" + building.level + "/40" + "</td></tr>";
			    		
			    		var property = building.property;			    					    		
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">提速: </td><td>" + property.reduce_time_rate + "%</td></tr>";
			    		
			    		$.each(soldiers, function(idx, soldier) {
			    			var name = soldier.name;
			    			var count = soldier.count;
			    			
			    			if (name == "frigate") {
			    				html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">强弩舰: </td><td>" + count + "</td></tr>";
			    				return;			    			
			    			}
			    			
			    			if (name == "destroyer") {
			    				html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">火炮舰: </td><td>" + count + "</td></tr>";
			    				return;			    			
			    			}			    			
			    		});
			    					    					    					    			    			    			
			    		html += "</table>";
			    		html += "</td>";
			    		
			    		if (!tr) {
							html += "</tr>";
							tr = true;
						} else
							tr = false;
							
						return;					
			    	}					
				});
				
				$.each(buildings, function(idx, building) {
					if (building.building_type == 11) {
						if (tr)
							html += "<tr>";
						
						html += "<td width=\"10%\" align=\"center\">";
						html += "<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
						html += "<tr>";
						html += "<td height=\"20\" align=\"center\">";				
			    					    		
			    		if (building.status == "upgrading")
			    			html += "<span style=\"color:#FF0000\" title=\"" + getFinishTime(buildingQueues, building.id, false) + "\">城墙</span>";											
						else
							html += "<a href=\"#\" onclick=\"upgradeBuilding(" + building.id + ");return false;\" class=\"AdminToolsLink1\">城墙</a>";
			    		 					    		
			    		html += "</td>";
			    		html += "</tr>";
			    		html += "<tr><td height=\"20\">" + building.building_type + "</td></tr>";
			    		html += "</table>";
			    		html += "</td>";	    		
			    		html += "<td width=\"40%\">";
			    		html += "<table width=\"94%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">等级: </td><td>" + building.level + "/40" + "</td></tr>";
			    		
			    		var property = building.property;			    					    		
			    		html += "<tr><td align=\"left\" height=\"25\" width=\"34%\">防御: </td><td>" + property.defense + "</td></tr>";
			    		
			    		var towers = building.towers;
			    		if (towers != null) {
			    			$.each(towers, function(idx, tower) {
				    			
				    		});
			    		}			    					    		
			    					    					    					    			    			    			
			    		html += "</table>";
			    		html += "</td>";
			    		
			    		if (!tr) {
							html += "</tr>";
							tr = true;
						} else
							tr = false;
							
						return;					
			    	}					
				});
				
				html += "</table><br/>";
				
				var divTown = "town_" + id;
				if ($("#" + div).find("#" + divTown).length == 0) {
					html = "<div id=\"" + divTown + "\">" + html + "</div>";
					$("#" + div).append(html);				
				} else
					$("#" + divTown).html(html);								
			}
			
			getMyTowns();
		</script>
	</body>
</html>